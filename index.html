<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/assets/logo.svg" />
    <title>Octra Wallet Generator</title>
    <style>
        @font-face {
          font-family: 'National';
          src: url('/assets/national-regular.woff2') format('woff2');
          font-weight: 400;
          font-style: normal;
          font-display: swap;
       }
       
       @font-face {
          font-family: 'FoundersGrotesk';
          src: url('/assets/founders-grotesk-bold.woff2') format('woff2');
          font-weight: 700;
          font-style: normal;
          font-display: swap;
       }
       
        :root {
            /* Colors from Figma design system */
            --blue-50-base: #0000db;
            --blue-40: #043aff;
            --blue-30: #6196ff;
            --blue-20: #b1c8fb;
            --blue-10: #ecf2ff;
            --blue-60: #0808a0;
            --blue-70: #06066f;
            --blue-80: #040525;
            
            --gray-0: #ffffff;
            --gray-10: #f1f1f1;
            --gray-20: #eaeaea;
            --gray-30: #dedede;
            --gray-40: #9b9b9b;
            --gray-50: #696969;
            --gray-60: #313131;
            --gray-70: #222222;
            --gray-80: #181818;

            --orange-10: #ffeec2;
            --orange-20: #fcb73e;
            --orange-30: #ef8b17;
            --orange-40: #d97400;
            --orange-80: #432f18;
            
            --text-main: #222222;
            --button-primary-text: #ffffff;
            --template-background: #ffffff;
            --border-disabled: #dedede;
            --border-color-500: #15151566;
            
            /* Legacy variables for compatibility */
            --background-default-color: #181818;
            --background-primary-color: var(--blue-50-base);
            --text-primary-color: var(--button-primary-text);
            --text-inverted-color: var(--button-primary-text);
            --border-color: var(--gray-40);
        }
        
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            print-color-adjust: exact;
            font-family: 'National', Tahoma, Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-size: 18px;
            line-height: 26px;
            font-weight: 400;
            margin: 0;
            padding: 0;
            background-color: var(--background-default-color);
            color: var(--text-inverted-color);
        }
        
        .container {
            max-width: 1024px;
            width: 100%;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            font-family: 'FoundersGrotesk', 'National', sans-serif;
            font-size: 62px;
            line-height: 64px;
            font-weight: 700;
            margin-bottom: 40px;
            letter-spacing: -0.02em;
        }
        
        h3 {
            font-family: 'FoundersGrotesk', 'National', sans-serif;
            font-size: 36px;
            line-height: 42px;
            font-weight: 700;
            margin-bottom: 16px;
        }
        
        h5 {
            font-family: 'National', sans-serif;
            font-size: 18px;
            line-height: 22px;
            font-weight: 700;
        }
        
        .button {
            outline: 1px solid var(--blue-50-base);
            background: var(--blue-50-base);
            color: var(--button-primary-text);
            border: none;
            padding: 8px 16px;
            text-align: center;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-family: 'National', sans-serif;
            font-size: 18px;
            line-height: 26px;
            font-weight: 400;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 0;
            transition: background-color 0.2s, border-color 0.2s;
            min-height: 42px;
        }
        
        .button:hover {
            background: var(--blue-40);
            outline-color: var(--blue-40);
        }
        
        .button:disabled {
            background-color: var(--gray-10);
            outline: none;
            color: var(--gray-40);
            cursor: not-allowed;
        }
        
        .button.secondary {
            background: var(--gray-0);
            color: var(--text-main);
            outline-color: var(--gray-40);
        }
        
        .button.secondary:hover {
            background: var(--gray-10);
            outline-color: var(--gray-40);
        }
        
        .button.secondary:disabled {
            background: var(--gray-10);
            color: var(--gray-40);
            outline-color: var(--border-disabled);
        }
        
        .button.borderless {
            background: var(--gray-0);
            color: var(--text-main);
            outline: none;
        }
        
        .button.borderless:hover {
            background: var(--gray-10);
        }
        
        .button.borderless:disabled {
            background: var(--gray-10);
            color: var(--gray-40);
        }
        
        .button.size-large {
            padding: 10px 16px;
            font-size: 20px;
            line-height: 30px;
            min-height: 50px;
        }
        
        .button.size-xl {
            padding: 12px 16px;
            font-size: 24px;
            line-height: 32px;
            min-height: 56px;
        }
        
        .button.selected {
            outline: 3px solid var(--blue-40);
            outline-offset: -1.5px;
        }
        
        .button.selected.primary {
            outline: 2px solid var(--blue-40);
            outline-offset: -2px;
            border: 1px solid var(--gray-0);
        }

        .button.fullwidth {
            width: 100%;
        }
        
        .status {
            margin: 40px 0 16px;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            min-height: 104px;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 400px;
            font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New', monospace;
            font-size: 14px;
            line-height: 18px;
            font-weight: 400;
        }
        
        .wallet-info {
            background-color: transparent;
            padding: 20px 0;
            margin-top: 20px;
            display: none;
        }
        
        .wallet-field {
            margin: 20px 0;
            display: flex;
            flex-direction: row;
            box-sizing: border-box;
            gap: 24px;
        }
        
        .field-label {
            font-family: 'National', sans-serif;
            font-size: 16px;
            line-height: 20px;
            font-weight: 400;
            flex-basis: 200px;
        }
        
        .field-value {
            font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New', monospace;
            font-size: 14px;
            line-height: 18px;
            font-weight: 400;
            word-break: break-all;
            width: 100%;
        }

        .field-value.inputs {
            margin-top: -12px;
        }
        
        .warning {
            background-color: var(--gray-60);
            color: var(--text-inverted-color);
            padding: 12px 16px 12px 36px;
            margin: 20px 0;
            font-family: 'National', sans-serif;
            position: relative;
            font-size: 16px;
            line-height: 20px;
        }

        .warning::before {
            content: '';
            position: absolute;
            background: url('assets/icon-warning.svg') 0 0 no-repeat;
            width: 16px;
            height: 16px;
            left: 12px;
            top: 14px;
        }
        
        .address-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        select, input[type="number"] {
            background: var(--background-default-color);
            color: var(--text-inverted-color);
            border: 1px solid var(--gray-40);
            padding: 8px 12px;
            border-radius: 0;
            font-family: 'National', sans-serif;
            font-size: 16px;
            line-height: 22px;
            font-weight: 500;
        }
        
        select:focus, input[type="number"]:focus {
            outline: 2px solid var(--blue-40);
            outline-offset: -2px;
            border-color: var(--blue-40);
        }
        
        select:disabled, input[type="number"]:disabled {
            background: var(--gray-10);
            color: var(--gray-40);
            border-color: var(--border-disabled);
            cursor: not-allowed;
        }
        
        .derive-button {
            padding: 6px 12px;
            font-size: 16px;
            line-height: 24px;
            margin-left: 4px;
            min-height: 36px;
        }
        
        /* Typography classes from Figma design system */
        .text-h1 {
            font-family: 'FoundersGrotesk', sans-serif;
            font-size: 62px;
            line-height: 64px;
            font-weight: 700;
        }
        
        .text-h3 {
            font-family: 'FoundersGrotesk', sans-serif;
            font-size: 36px;
            line-height: 42px;
            font-weight: 700;
        }
        
        .text-h5 {
            font-family: 'National', sans-serif;
            font-size: 18px;
            line-height: 22px;
            font-weight: 700;
        }
        
        .text-huge {
            font-family: 'National', sans-serif;
            font-size: 24px;
            line-height: 32px;
            font-weight: 400;
        }
        
        .text-large {
            font-family: 'National', sans-serif;
            font-size: 20px;
            line-height: 30px;
            font-weight: 400;
        }
        
        .text-normal {
            font-family: 'National', sans-serif;
            font-size: 18px;
            line-height: 26px;
            font-weight: 400;
        }
        
        .text-small {
            font-family: 'National', sans-serif;
            font-size: 16px;
            line-height: 22px;
            font-weight: 500;
        }
        
        .text-extra-small {
            font-family: 'National', sans-serif;
            font-size: 14px;
            line-height: 20px;
            font-weight: 400;
        }
        
        .text-mono {
            font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New', monospace;
            font-size: 14px;
            line-height: 18px;
            font-weight: 400;
        }
        
        #derivedAddress {
            margin-top: 15px;
            padding: 10px;
            background-color: var(--gray-60);
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>octra wallet generation</h1>

        <div class="main">
        <div>
            <div class="status" id="status">Ready to generate wallet...</div>
            
            <div style="text-align: center;">
                <button id="generateBtn" class="button size-large fullwidth" onclick="generateWallet()">generate new wallet</button>
            </div>
        </div>    
        
        <div class="wallet-info" id="walletInfo">
            <h3>your wallet</h3>
            <div class="warning">
                do not store this file online or on cloud services, keep your private key secure and never share it!
            </div>
            
            <div class="wallet-field">
                <div class="field-label">mnemonic (12 words)</div>
                <div class="field-value" id="mnemonic"></div>
            </div>
            
            <div class="wallet-field">
                <div class="field-label">private key</div>
                <div class="field-value">
                    Raw: <span id="privateKeyRaw"></span><br>
                    B64: <span id="privateKeyB64"></span>
                </div>
            </div>
            
            <div class="wallet-field">
                <div class="field-label">public key</div>
                <div class="field-value">
                    Raw: <span id="publicKeyRaw"></span><br>
                    B64: <span id="publicKeyB64"></span>
                </div>
            </div>
            
            <div class="wallet-field">
                <div class="field-label">octra addres</div>
                <div class="field-value" id="address"></div>
            </div>
            
            <div class="wallet-field">
                <div class="field-label">technical information</div>
                <div class="field-value">
                    Entropy: <span id="entropy"></span><br>
                    Seed: <span id="seed"></span><br>
                    Master Chain: <span id="masterChain"></span>
                </div>
            </div>
            
            <div class="wallet-field">
                <div class="field-label">signature test</div>
                <div class="field-value">
                    Message: <span id="testMessage"></span><br>
                    Signature: <span id="testSignature"></span><br>
                    Validation: <span id="signatureValid"></span>
                </div>
            </div>
            
            <div class="wallet-field">
                <div class="field-label">HD derivation</div>
                <div class="field-value inputs">
                    <label>Network Type: 
                        <select id="networkType">
                            <option value="0">MainCoin</option>
                            <option value="1">SubCoin</option>
                            <option value="2">Contract</option>
                            <option value="3">Subnet</option>
                            <option value="4">Account</option>
                        </select>
                    </label>
                    <label style="margin-left: 10px;">Index: 
                        <input type="number" id="derivationIndex" value="0" min="0" max="100" style="width: 60px;">
                    </label>
                    <button class="button derive-button" onclick="derivePath()">derive</button>
                    <div id="derivedAddress" style="display: none;">
                        Derived Address: <span id="derivedAddressValue"></span><br>
                        Path: <span id="derivedPath"></span>
                    </div>
                </div>
            </div>
            
            <div class="wallet-field" id="saveInfo" style="display: none;">
                <div class="field-label">file saved</div>
                <div class="field-value">
                    Filename: <span id="savedFilename"></span><br>
                    Location: In the same directory as this script
                </div>
            </div>
        </div>
        </div>
    </div>
    
    <script>
        let currentWallet = null;
        
        function updateStatus(message) {
            const status = document.getElementById('status');
            status.textContent += message + '\n';
            status.scrollTop = status.scrollHeight;
        }
        
        async function derivePath() {
            if (!currentWallet) {
                alert('Please generate a wallet first');
                return;
            }
            
            const networkType = parseInt(document.getElementById('networkType').value);
            const index = parseInt(document.getElementById('derivationIndex').value);
            
            try {
                const response = await fetch('/derive', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        seed_hex: currentWallet.seed_hex,
                        network_type: networkType,
                        index: index
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    document.getElementById('derivedAddressValue').textContent = result.address;
                    document.getElementById('derivedPath').textContent = result.path;
                    document.getElementById('derivedAddress').style.display = 'block';
                } else {
                    alert('Derivation failed: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        async function generateWallet() {
            const btn = document.getElementById('generateBtn');
            const status = document.getElementById('status');
            const walletInfo = document.getElementById('walletInfo');
            
            btn.disabled = true;
            status.textContent = '';
            walletInfo.style.display = 'none';
            
            updateStatus('Starting wallet generation...');
            
            try {
                const response = await fetch('/generate', {
                    method: 'POST'
                });
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = JSON.parse(line.substring(6));
                            
                            if (data.status) {
                                updateStatus(data.status);
                            }
                            
                            if (data.wallet) {
                                currentWallet = data.wallet;
                                displayWallet(data.wallet);
                            }
                        }
                    }
                }
            } catch (error) {
                updateStatus('ERROR: ' + error.message);
            } finally {
                btn.disabled = false;
            }
        }
        
        function displayWallet(wallet) {
            document.getElementById('mnemonic').textContent = wallet.mnemonic.join(' ');
            document.getElementById('privateKeyRaw').textContent = wallet.private_key_hex;
            document.getElementById('privateKeyB64').textContent = wallet.private_key_b64;
            document.getElementById('publicKeyRaw').textContent = wallet.public_key_hex;
            document.getElementById('publicKeyB64').textContent = wallet.public_key_b64;
            document.getElementById('address').textContent = wallet.address;
            document.getElementById('entropy').textContent = wallet.entropy_hex;
            document.getElementById('seed').textContent = wallet.seed_hex.substring(0, 64) + '...';
            document.getElementById('masterChain').textContent = wallet.master_chain_hex;
            document.getElementById('testMessage').textContent = wallet.test_message;
            document.getElementById('testSignature').textContent = wallet.test_signature;
            document.getElementById('signatureValid').textContent = wallet.signature_valid ? 'VALID' : 'INVALID';
            
            document.getElementById('walletInfo').style.display = 'block';
            
            // Auto-save wallet
            saveWallet();
        }
        
        async function saveWallet() {
            if (!currentWallet) return;
            
            try {
                const response = await fetch('/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(currentWallet)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    updateStatus('Wallet saved to: ' + result.filename);
                    
                    document.getElementById('savedFilename').textContent = result.filename;
                    document.getElementById('saveInfo').style.display = 'flex';
                } else {
                    updateStatus('ERROR: Failed to save wallet');
                }
            } catch (error) {
                updateStatus('ERROR: ' + error.message);
            }
        }
    </script>
</body>
</html> 